# Subnet Custom Resource Definition
# Defines the Subnet CRD for managing network subnets in zstack-ovn-kubernetes
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: subnets.network.zstack.io
  labels:
    app.kubernetes.io/name: zstack-ovn-kubernetes
spec:
  group: network.zstack.io
  names:
    kind: Subnet
    listKind: SubnetList
    plural: subnets
    singular: subnet
    shortNames:
      - sn
  scope: Cluster
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          description: Subnet is the Schema for the subnets API
          properties:
            apiVersion:
              type: string
              description: 'APIVersion defines the versioned schema of this representation of an object.'
            kind:
              type: string
              description: 'Kind is a string value representing the REST resource this object represents.'
            metadata:
              type: object
            spec:
              type: object
              description: SubnetSpec defines the desired state of Subnet
              required:
                - cidr
                - gateway
              properties:
                cidr:
                  type: string
                  description: 'CIDR is the IP range for this subnet (e.g., "10.244.0.0/16")'
                  pattern: '^([0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$'
                gateway:
                  type: string
                  description: 'Gateway is the default gateway IP for this subnet'
                  pattern: '^([0-9]{1,3}\.){3}[0-9]{1,3}$'
                excludeIPs:
                  type: array
                  description: 'ExcludeIPs is a list of IP addresses or ranges to exclude from allocation'
                  items:
                    type: string
                externalLogicalSwitch:
                  type: string
                  description: 'ExternalLogicalSwitch is the name of an existing OVN Logical Switch to reference (for external mode)'
                vlanID:
                  type: integer
                  description: 'VlanID is the VLAN ID for underlay networks'
                  minimum: 1
                  maximum: 4094
                provider:
                  type: string
                  description: 'Provider is the physical network provider name for underlay networks'
                protocol:
                  type: string
                  description: 'Protocol is the IP protocol version'
                  enum:
                    - IPv4
                    - IPv6
                    - Dual
                  default: IPv4
            status:
              type: object
              description: SubnetStatus defines the observed state of Subnet
              properties:
                phase:
                  type: string
                  description: 'Phase is the current phase of the subnet'
                  enum:
                    - Pending
                    - Active
                    - Failed
                reason:
                  type: string
                  description: 'Reason provides additional information about the current phase'
                availableIPs:
                  type: integer
                  description: 'AvailableIPs is the number of available IP addresses'
                usedIPs:
                  type: integer
                  description: 'UsedIPs is the number of used IP addresses'
                logicalSwitch:
                  type: string
                  description: 'LogicalSwitch is the name of the associated OVN Logical Switch'
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: CIDR
          type: string
          jsonPath: .spec.cidr
          description: 'The CIDR of the subnet'
        - name: Gateway
          type: string
          jsonPath: .spec.gateway
          description: 'The gateway IP of the subnet'
        - name: Phase
          type: string
          jsonPath: .status.phase
          description: 'The current phase of the subnet'
        - name: Available
          type: integer
          jsonPath: .status.availableIPs
          description: 'Number of available IPs'
        - name: Used
          type: integer
          jsonPath: .status.usedIPs
          description: 'Number of used IPs'
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
